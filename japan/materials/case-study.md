# InnerSource ケーススタディ (Draft)

## Japan Technology Company 社の InnerSource Hard Things

### 1. Story (2023/01)

**Japan Technology Corp (J-Tech社)** は日本の向上向け製造業の大手です。グローバルで2万人の従業員を抱え、日本には15,000人程度が働いています。日本の開発者も5000人ほどおり、エンジニアの数は多いです。2000人が製品開発部で3000人が顧客向けのシステムインテグレーションやカスタマイズを行っています。
斉藤和夫さんは普段J-Tech社の R&D チームで IoT デバイスに搭載するソフトウェアを作っています。
正式な部署名は "先進IoT基盤開発本部" です。
斉藤さんのチームには5人の正社員エンジニアがおり、斉藤さんは2023年11月にリリースするプロジェクトのリードをつとめています。
今斉藤さんが開発しているのは WheelMQ という Java で作られた MQTT ブローカーです。エッジデバイスに搭載されます。
チームにはその他のアプリケーションを開発している人も在籍しています。

最近、斉藤さんは社外の勉強会でインナーソースという概念を知りました。
インナーソースという考えを適用させれば、組織でソースコードの共有をすることにより組織のサイロが壊せるとのことでした。
いままで J-Tech 社には作られた IoT デバイス用のアプリケーションが多数あり、それぞれの部門がそれぞれのアプリケーションを作ってきました。
そんな非効率な現場を目撃している斉藤さんは、インナーソースの考えに共感して自分のチームにも適用しようと思っています。
WheelMQのようなソフトウェアは比較的再利用される可能性が高く、斉藤さんも「インナーソースにぴったり」という感覚を持っています。
もう車輪の再発明はごめんです！

- [x] インナーソースをやろうとする人がいる
- [x] 社内公開したら、社内開発者ユーザーに利益がありそうなプログラムがある

### 2. 環境の準備 (2023/01)

最近、J-Tech社には GitHub が導入されました。
全社的に GitHub の講習会があり、GitHub の Enterprise Repository では社内でソースコードを共有できるようになっています。
斉藤さんもアカウントを持っており、ソフトウェアのコードベースは
これで、社内にはソースコードが公開できそうです。

- [x] GitHub や GitLab などのコードホスティングサービスが社内導入されている
- [x] 社内のユーザーは Git を使ってコードを共有できるようになっている (知識や技術、社内ルールがある)

### 3. ワクワクしながら開発準備 (2023/01)

プロジェクトは50人月で見積もられており、予算は○○万円です。
斉藤さんはインナーソースでの開発をするためにインナーソースの本を読み漁りました。
インナーソースの考え方を知るには InnerSource Commons という団体があり、インナーソースの入門書や、インナーソースパターンブックなどは翻訳されています。
斉藤さんはインナーソースについて徐々に詳しくなってきました。
ひとまず README.md や CONTRIBUTING.md を書いてみて、インナーソースの入り口に立った斉藤さんは、ひとまず自分自身が WheelMQ のトラステッドコミッターになることにしました。
社内には Slack があり、コミュニケーションツーリングもばっちりです。
コミュニケーションは非同期で行われ、ドキュメントもきちんと書かれ、意思決定も透明性があるものにしています。
普段 Excel で管理していた実装計画や、オフィスでの立ち話で決めていた決め事は今はもうドキュメントになっています。
今までのプロジェクトよりは書き物が多くなって大変ですが、「自分の書いたコードが誰かに再利用してもらうなら楽しい！」と斉藤さんは意気込んでいます。
しかし、チームメンバーにはこのコミュニケーションに慣れていない人もいるようです。

- [x] インナーソースの知見を知っている人がいる。
- [x] インナーソースのプラクティスを試してみることができる。(プロジェクト進行に関する柔軟性がある)
- [ ] ドキュメンテーションなどには慣れていない。稼働は多くなってしまったが、軽減する手段がある

### 4. 開発がはじまるが... (2023/02)

斉藤さんはドキュメントを拡充しながら、自分自身でプルリクエストやイシューにコメントを書きながらチームで開発を進めていました。
開発はオープンソースさながらですが、問題がありました。
インナーソースのプロジェクトに貢献する人が誰もいないのです。
これではただの GitHub を使ったよくある開発です。
斉藤さんは「最悪それでも普段よりは良いかもしれない」と思い、へこたれてはいませんでしたが、せっかくインナーソースをやるのだから1、2人くらいはコミットしてくれてもいいのになと思いました。
斉藤さんはインナーソースの活動を広げて宣伝してみることにしました。
しかし、社内でどこから何を始めたら良いのかわかりません。
インナーソースでまずは勉強会をしてみることにしました。
斉藤さんの会社には社内勉強会を開いている人がたまにいますが、正式な活動ではなく、その活動が評価されるかどうかは組織や上長に依存します。
斉藤さんはもっとこういう活動が社内で広がればいいのにと思っています。

- [x] インナーソースは長期的な旅であるという理解をしている
- [ ] 社内勉強会を開ける社風や時間、評価制度がある

### 5. 勉強会の開催!! だが... (2023/02)

斉藤さんは勉強会を開催しました。
勉強会には技術好きなおじさんから新卒の若者までたくさん参加しています。
最近はコロナでリモートの開発者が増えているので、Zoom ミーティングには50人が参加しているようでした。
Zoom で「インナーソースについて初めて聞く人」にリアクションをとってもらおうとしましたが、手が上がったのは15人程度でした。
一方で「インナーソースについて知っている人」というと2,3 人のリアクションがありました。
どうやら大半は内職をしながら流し聞しているようです。
一部の物好きな参加者はインナーソースのアイデアに強く共感して、「わたしのところでもできたらいいな」というコメントを残してくれました。
斉藤さんはインナーソースの勉強と同時に「ぜひプルリクエストを送ってみてください！」という強いメッセージを参加者に送りました。

- [ ] インナーソースを社内で広めるためのリソースがインターネットで手に入る
- [ ] 社内勉強会には他のチームの人も参加可能

### 5. 勉強会の結果が悪い (2023/02)

その後、斉藤さんは新人から感謝のメールを何通か受け取りました。
またリポジトリのスターは勉強会後にポツポツ増えたりしました。
しかし、全体からすると勉強会の結果はあまりよくありませんでした。
参加者アンケートをとると、斉藤さんの勉強会自体はとても評判が良かったのですが、「うちにも導入したいけど、ちょっと大変そう」というコメントも多数見受けられました。
斉藤さんはちょっとがっかりしました。
斉藤さんは上長とインナーソースの進捗がよくないことを話したところ、上長は同じR&D部の田辺さんを紹介してくれました。
田辺さんは凄腕のエンジニアとして有名で、 MQTT のプロトコルにも精通しており、アドバイスをくれるとのことでした。
早速斉藤さんは田辺さんに話をしてみました。

- [x] まわりに頼れる人がいるか

### 6. 凄腕の田辺さん (2023/03)

田辺さんにインナーソースの話と WheelMQ について話すと、田辺さんは共感をしてくれました。
田辺さんは今までライブラリを綺麗に設計したり、SOA を適用したサービス開発の経験もありました。
最近田辺さんはプライベートの時間を使ってエッジデバイス上で Kubernetes を動かし、マイクロサービス化した IoT 開発を趣味でしているようですが、業務ではその分野の技術を使うことは全くありません。
斉藤さんはインナーソースというアイデアがいかに素晴らしいのかを語りました。
田辺さんは「よくあるコンポーネント分離の話と、コードの共同所有のお話だね」と既存の知識から勘所を理解したようです。
田辺さんは忙しい人でしたので、ソースコードの貢献はできないけれど、レビューやフィーチャーリクエストならできるかもと言ってくれました。
少し経つと、田辺さんは斉藤さんのチームのプルリクエストにツッコミを入れてくれたり、イシューにバグ報告をしてくれるようになりました。
コードの貢献はありませんでしたが、これは大きな一歩です。

- [x] インナーソースに共感できるパートナーを探すことができるか。

### 7. 若手エンジニアの初のコミット (2023/05)

そんなこんなで泣かず飛ばずの斉藤さんのインナーソースプロジェクトでしたが、
田辺さんからの助けや紹介もあって、若手エンジニアの金井さんも少しコンポーネントの開発を手伝ってくれることになりました。
しかし、金井さんはちゃんと人事的に評価されるのかは気になるところです。
金井さんはまだ若手で第一級の戦闘力としては認識されていないようでしたが、やる気もあって技術のキャッチアップも早い優秀なエンジニアでした。
斉藤さんは金井さんの稼働を少しだけもらうことにしました。
社内兼業の規定は特にありませんでしたが、あくまでもその若手エンジニアは**同じ部門でしたので**、上長間でのコミュニケーションでこの話は解決しました。
テストコードやドキュメントのコントリビューションからはじまり、一部のライブラリコードもコントリビューションしてくれました。
斉藤さんは WheelMQのContributors に外部の人が増えたことを嬉しく思いました。

- [ ] インナーソースに関する人事の評価制度がある
- [ ] 契約コントリビュータのようなパターンが採用可能
- [ ] 上長同士でお金にかんして話し合える環境や(ゆるい)標準がある

### 8. WheelMQ 初の外部利用！ (2023/07)

開発自体はほぼ終わり、今は受け入れテストをしています。
バグがでているので斉藤さんのタスクもバグを潰したりドキュメントを書く仕事が多くなってきました。
そんななか、この WheelMQ を実験的に使ってみたいという話がきました。
その要求は若手エンジニア金井さんの隣の先進IoT基盤開発本部のプラントIoT開発部からのお話でした。
これは斉藤さんの日々の頑張りやインナーソース普及活動の成果、田辺さん、金井さんの頑張りによるものでしょう。
このころ金井さんは他のプロジェクトで忙しくなったため、今ではほとんどコントリビューションしていませんでした。

さて、WheelMQ の開発にはプラントIoT開発部のチームAから2人加わってくれることになりました。
追加開発部分は通信に関するセキュリティの向上やクラウド連携機能の追加開発です。
そのほかにはパブリッシュリクエストのペイロードの容量を128KBから 256KB への拡張するリクエストもあります。
現在 WheelMQ は会計上研究開発費として計上されています。

斉藤さんはプラントチームAの課長と話し合い、どのような内部的な会計で計上するのかを決めました。
追加開発部分もそこまで多くなかったので
ひとまず研究開発の作業としてチームAのメンバーが入ることになりました
前回金井さんが参画してくれたように、この交渉はマネージャー同士で比較的スムーズに行われました。

- [ ] TBD: チーム間の会計処理のすり合わせのテンプレート(研究開発費)

### 9. WheelMQ のオンボーディングが大変 (2023/09)

斉藤さんは WheelMQ の影響範囲が１プロジェクトから2プロジェクトに増えたことでバージョン管理や互換性、イシューの管理をもっとしっかりする必要が出てきました。
チームAのメンバーは適当な名前のブランチを切って、GitHub イシューも適当に書いてきます。
斉藤さんは Issue Template を使うなどして、もう少し情報が残りやすいようにコミュニケーションコストを下げる努力をしました。
斉藤さんはこの段階で インナーソースパターンで書かれていたことを活用できました。

- [ ] Issue Template など、GitHub の使い方がわかる
- [ ] チーム間コラボレーションのやり方に関する知見がある。

### 9. WheelMQ を含むプロジェクトのリリース (2023/11)

プロジェクトは無事リリースされました。
多くの運営は運用保守の部門の管理下になりましたが、引き続き WheelMQ に関しては斉藤さんが持つことになりました
しかし、ここで一つ困ったことがあります。
プロジェクトは商用利用されるようになったので、WheelMQも研究開発日からソフトウェアという無形資産に変わったのです。
本当は2ヶ月で終わるチームAのコントリビューションも、プロジェクトの状況が悪く、どんどん伸びていました。
チームAで使う WheelMQは、まだ研究開発費として扱いたいが、斉藤さんの初期WheelMQはもう商用利用されているので、ソフトウェアになっているという食い違う状況が生まれています。
コードについては詳しいが、会計の仕組みに関してはあまり知らない斉藤さんは経理の人にどうしたらいいのか聞きました。
経理の人は「それなら●●●●●●●●●●●● がいいよ」と良いベストプラクティスを教えてくれました。

- [ ] ウォーターフォールで開発した部品をインナーソースで開発した場合、その運用保守は誰がやるのかに関する解がある
- [ ] TBD: 良いベストプラクティスを InnerSource Commons で開発する
  - [ ] 研究開発費とソフトウェアではどう変わる？

### 10. WheelMQ の追加開発 (2023/12)

そんなこんなで、経理のアドバイスもありうまくチームAとのコラボレーションが実現した斉藤さんは鼻高々です。
チームA は一通りの初期の開発を現在終えています。
しかしチームAは一部の機能の開発にベンダーの社員を起用したいと考えるようになりました。
斉藤さんもチームAの正社員もリモートワークが許されていますが、ベンダー社員は基本的にオフィスにいるしかなく、エンタープライズリポジトリの権限もありません。
斉藤さんは情シスと掛け合ってこの権限の設定をしていきました。
これでベンダー社員もインナーソースのリポジトリに限っては貢献ができるようになりました。

- [ ] コードの機密レベル/権限ををどう設定するか (GitHub / GitLab のベストプラクティス)
- [ ] どこからでも高頻度に貢献できるような情報インフラの構築に難がある
- [ ] 情報システム部との連携が可能

### 11. WheelMQ の開発が続く (2023/11)

コントリビューションは落ち着いてきましたが、ユーザーはどんどん増えてきました。
一方で同時に非コードのコントリビューションも増えてきました。
今では開発に8チームが関わっています。
現在の WheelMQ のコードベースはどのように構築されているかというと、OSS のライブラリによってもたらされる価値に加え、斉藤さんのチームが書いた大多数のコード、チームAの追加開発範囲、そして、その他6チームが利用する際に直したバグやプルリクエスト、ドキュメンテーションのコントリビューションからなっています。
今ではトラステッドコミッターは4人います。
斉藤さんと斉藤さんのチームメンバー2人(田代さん、竹内さん)、そしてチームAの小柳さんです。
継続的に開発は行われており、ISSのメンテナンスが行われています。
ここで問題が起きました。6チームにまたがる人材が縦横無尽にインナーソースのコードにコントリビューションする中で、誰がどのくらいの工数を使っているのかがわからないのです。
今まではチームAの上長とやりとりをしていましたが、ステークホルダーが増えた今、全員と会話をして調整をつけるのは現実的ではありません。
なにかルールが必要です。しかし、トップダウンで決められたルールではなく、ボトムアップ的にタスクがこなされていたため、それぞれのコントリビューターの工数はあまり正しく管理されていませんでした。
また、コードのコントリビューション以外にもドキュメントやバグ報告、イシューなどの非コードのコントリビューションもあったため、斉藤さんはどうしたら良いのかがわかりません。
今までも個人のコントリビューションは少なからずありましたが、その都度コミュニケーションをとってきました。斉藤さんはもう他のプロジェクトにもアサインされているため、疲弊しています。
こういったコミュニケーションに時間を割きたくありません。
むしろ斉藤さんは「はじめから成分律があったらよかったのに...」と思っています。
そんななか次年度の予算計画の話が斉藤さんに降りてきました。

- [ ] 会計のやりとりのスタンダード(社内)が存在する。
- [ ] ソフトウェアの会計上の評価方法(日本標準)が存在する

### 12. 脱予算 (2023/12)

斉藤さんは次期の予算計画を立てなければいけません。
しかし、斉藤さんは考えてみると、WheelMQ はすでにさまざまなプロジェクトが使っています。
なぜ斉藤さんが権限を持って色々決めなければいけないのでしょうか。
斉藤さんはそろそろ違うところにも労力を注ぎ込みたいと考えています。
斉藤さんは予算計画を立てなければいけないですが、WheelMQのための工数と現在のプロジェクトの折り合いをつけたいと考えています。

- [ ] インナーソース化されたプロジェクトと予算に関するベストプラクティス（特に単年度での）
- [ ] テンプレート/事例など
- [ ] ステークホルダーへの訴求方法

### 13. ISPO をたてる (2024/08)

斉藤さんはこの頃からインナーソースを斉藤さんがイニシアチブを持って進めているのがなぜかよくわからなくなっていました。
社内では「インナーソースなら斉藤さん」という認知をされて、いろいろな質問が来ました。
しかし、斉藤さんは少しばかりのポジティブな人事評価を得たのみで、作業が割りに合わないと感じていました。
またそもそも、こういった取りくみは個人ではなく、社内の組織によってガバナンスが効かせられる必要があると考えていました。
インナーソースを全社的に進める組織が必要です。
そんななかで、斉藤さんはマイクロソフトのインナーソース事例をみました。
マイクロソフトでは 1ES というチームが開発文化の中枢になっています。
斉藤さんは情シスで GitHub をロールアウトしている人たちにアプローチしました。
彼らは社内のアプリケーション基盤を作ったり、標準化活動に力を入れています。
斉藤さんは、ISPO の基盤を作るために働きかけを始めました。

- [ ] ISPO の役割、InnerSource Program Manager の職務内容(Job Description)
- [ ] アプリ基盤管理者から"インナーソースコミュニティマネージャー" に昇華させるための役割と、ギャップを埋めるためのトレーニング (Playbook など)

### 組織を超えて (グループ会社) 2024/12

J-Tech の子会社である J-Tech Business Solutions(JTBS) 社があります。
この会社は主に J-Tech の顧客への実装や統合作業を行っており、プロダクト開発の面でも一部を連携しています。
斉藤さんはかつてのプロジェクトで関わったことのあるJTBS社のエンジニアの田端さんとお話ししました。
田端さんはこのWheelMQのことを知っていました。
田端さんは今度JTBSのプロジェクトでWheelMQを使いたいが、要件を考えると追加開発が必要であると言ってきました。
斉藤さんは「いいよ」と軽く返事しましたが、あとで考えてみるとこれは問題になるのではないかと心配になりました。
あくまでも WheelMQ の持ち主は J-Tech だからです。ともすれば田端さんが法的エンティティを超えて無償でコントリビューションすることになりかねません。
斉藤さんはどうしたら良いのかがわからなくなりました。
今までは一社だけだったので、社内の管理会計の問題だったが、組織を越えるとグループ全体で調整を取る必要が出てきます。
いかにグループ企業だとしても**利益供与**にならないようにする必要があります。
また、斉藤さんはこれを機会に以下の3つのケースでちゃんと利益供与にならない仕組みを作っておく必要があるとかんがえました。

- [ ] 子会社が親会社に技術提供するケース
- [ ] 親会社が子会社に技術提供するケース
- [ ] 子会社が別の子会社に技術提供するケース

### 14. トラステッドコミッターの引き継ぎ (2025/01)

J-Tech が最近買収した会社で、アメリカのソフトウェア企業である Blue-Tech 社があります。
斉藤さんは、ISPO の立ち上げを一緒に行い、一定の評価を得てきました。
斉藤さんは今までの功績が評価され、かねての希望だった転籍の話が上から落ちてきました。
それは　Blue-Tech 社の開発基盤統合に参加するお話しです。
斉藤さんはアメリカで生活してみたいと考えていましたし、キャリアを考えるとこれはとても良い話だと思いました。
さて、斉藤さんは今までのJ-Tech の業務を引き継ぐことになりました。
もちろん WheelMQ のトラステッドコミッターとしての仕事もここで終わりです。
斉藤さんは CONTRIBUTING.md から自分を外してもらい、斉藤さんは"過去の名誉Contributor" に移動されました。

もともと斉藤さんのチームには斉藤さんの他に田代さん、竹内さんという二人のトラステッドコミッターがいましたが、竹内さんは一身上の都合から今ではIoTベンチャーに転職しています。
また、隣のチームAにいたエンジニアの小柳さんはもうプロジェクトを離れ、トラステッドコミッターとしての役割をあまりになっていません。
そのため、斉藤さんは田代さんに諸々のタスクを引き継ぎました。
2023年の開発着手時にはとてもシンプルで特定の機能しかなかった WheelMQ はもうすでにかなり多くの機能が含まれています。
実際には WheelMQ のトラステッドコミッターは田代さん1人です。斉藤さんは今後の管理体制に不安を感じましたが、田代さんは優秀な方なので大丈夫でしょう。

- [ ] トラステッドコミッターの育成
- [ ] トラステッドコミッタの引き継ぎ
- [ ] インナーソース資産の管理と社内での適正評価

### 国を超えて

さて、アメリカにまずは1年出航することになった斉藤さん、最初の３ヶ月はアメリカの文化に触れ、アメリカのスラングもこなれたものです。
Blue-Tech社はノースカロライナに本社があります。普段スーツを着ていた斉藤さんは、今ではジーパンにTシャツです。
Blue-Tech社は GitHub での開発に慣れていましたが、インナーソースの開発は特に意識されていませんでした。
斉藤さんはアメリカの会社だからさぞ進んでいるのかと思いましたが、以外にも縦割りで Blue-Tech 社のサイロ問題にも気づいてきました。
J-Tech にはいままで Job Description がなかったので、全てのエンジニアが「エンジニア」というタイトルで働いているのみでした。
最近日本では総合職採用からジョブ型採用が推進されているので ISPO の時にも インナーソースプログラムマネージャーという職務内容を定義できましたが
一方で、社内の構造が完全にジョブ型になっているかというとそんなことは全くありませんでした。

斉藤さんはインナーソースを Blue-Tech でも推進して、 J-Tech でもそれらのプログラムを使えるようにしたいと考えていました。
斉藤さんは、アメリカで一旗あげる希望を胸に、ワクワクしながらアメリカの生活を楽しんでいます。
斉藤さんはまだ課長級ですが、 J-Tech社の CTO に上り詰めて、J-Tech の中でのインパクトを持ちたいという野望があります。
斉藤さんはかつて、WheelMQ を開発した経験を社内に共有しましたが、そのなかで以外にも WheelMQ を触ってみたいというコメントを多くもらいました。
自分の牙城に興味を持ってもらえた斉藤さんはチャンスと思い、WheelMQ を Blue-Tech 社に展開しようとしました。
しかし3つの問題がありました。1つは GitHub Enterprise のインスタンスがJ-Tech と Blue-Tech で別管理だったこと、そしてドキュメントとコミュニケーションで英語をサポートしなければいけないこと、そしてもう一つが移転価格税制です。
ドキュメントの英語化はなんとかできます。田代さんも英語を話すことは難しいですが、英語を書いたり英語の論部を読んだりするのは得意です。それに今では DeepL が翻訳作業を助けてくれます。さて、斉藤さんは田代さんにもコミュニケーションをとって英語でコミュニケーションをスタートすることに同意しました。斉藤さんもドキュメントを英語に訳しました。
次に斉藤さんは移転価格税制に関して調べたいと思っています。InnerSource Commons にも移転価格税制に取り組んでいる人がいました。
OECD の移転価格税制をもとに考えていますが、これが正しい解なのかはわかっていませんし、頻繁にこの問題に対処できるのかがわかりません。

- [ ] インナーソースに適した輸出管理の方法がない
- [ ] 移転価格税制
- [ ] 英語のコミュニケーション
